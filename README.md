# Транспортный справочник

- Принимает на вход данные JSON-формата, выдает ответ на запросы к справочнику (поиск маршрутов, расчет времени поездки);
- Визуализирует карту маршрутов в формате SVG;
- Реализован конструктор JSON, позволяющий находить неправильную последовательность методов на этапе компиляции.
   
*Для сборки проекта необходима поддержка стандарта не ниже С++20.*

## Запуск программы
Для создания базы справочника программу необходимо запустить, указав при этом входной JSON-файл.  
Пример запуска программы для заполнения базы:  
`transport_catalogue.exe <in.json`

В ответ, программа создаст два файла:
- `out.json` - ответы на запросы к справочнику;
- `out_image.svg` - визуализиция остановок и маршрутов.

## Формат входных данных
Входные данные поступают программе из stdin в формате JSON-объекта, который имеет на верхнем уровне следующую структуру:
```
{
  "base_requests": [ ... ],
  "render_settings": { ... },
  "routing_settings": { ... },
  "stat_requests": [ ... ]
}
```
Это словарь, содержащий ключи:
- `base_requests` — массив с описанием автобусных маршрутов и остановок;
- `render_settings` — словарь для отрисовки изображения;
- `routing_settings` — словарь, содержащий в себе настройки для скорости автобусов и времени ожидания на остановке;
- `stat_requests` — массив с запросами к транспортному справочнику.

### Содержание base_requests
Массив `base_requests` может содержать в себе информацию двух типов:
- Описание остановки — словарь с ключами:
    - `type` — строка "Stop", означающая, что объект описывает остановку;
    - `name` — название остановки;
    - `latitude` и `longitude` задают координаты широты и долготы остановки;
    - `road_distances` — словарь, задающий расстояние до соседних остановок. Ключ — название остановки, значение — целое число в метрах.
- Описание автобусного маршрута — словарь с ключами:
    - `type` — строка"Bus", означающая, что объект описывает автобусный маршрут;
    - `name` — название маршрута;
    - `stops` — массив с названиями остановок, через которые проходит автобусный маршрут. У кольцевого маршрута название последней остановки дублирует название первой. Например: `["stop1", "stop2", "stop3", "stop1"]`;
    - `is_roundtrip` — значение типа bool. Указывает, кольцевой маршрут или нет.
#### Пример описания остановки
```
{
  "latitude": 55.574371,
  "longitude": 37.6517,
  "name": "Biryulyovo Zapadnoye",
  "road_distances": {
    "Biryulyovo Tovarnaya": 2600
  },
  "type": "Stop"
}
```
#### Пример описания автобусного маршрута
```
{
  "is_roundtrip": true,
  "name": "297",
  "stops": [
    "Biryulyovo Zapadnoye",
    "Biryulyovo Tovarnaya",
    "Universam",
    "Biryulyovo Zapadnoye"
  ],
  "type": "Bus"
}
```
### Структура словаря render_settings
- `width` и `height` — ключи, которые задают ширину и высоту в пикселях. Вещественное число в диапазоне от `0` до `100000`.
- `padding` — отступ краёв карты от границ SVG-документа. Вещественное число не меньше `0` и меньше `min(width, height)/2`.
- `line_width` — толщина линий, которыми рисуются автобусные маршруты. Вещественное число в диапазоне от `0` до `100000`.
- `stop_radius` — радиус окружностей, которыми обозначаются остановки. Вещественное число в диапазоне от `0` до `100000`.
- `bus_label_font_size` — размер текста, которым написаны названия автобусных маршрутов. Целое число в диапазоне от `0` до `100000`.
- `bus_label_offset` — смещение надписи с названием маршрута относительно координат конечной остановки на карте. Массив из двух элементов типа `double`. Задаёт значения свойств `dx` и `dy` SVG-элемента `text`. Элементы массива — числа в диапазоне от `–100000` до `100000`.
- `stop_label_font_size` — размер текста, которым отображаются названия остановок. Целое число в диапазоне от `0` до `100000`.
- `stop_label_offset` — смещение названия остановки относительно её координат на карте. Массив из двух элементов типа double. Задаёт значения свойств `dx` и `dy` SVG-элемента `text`. Числа в диапазоне от `–100000` до `100000`.
- `underlayer_color` — цвет подложки под названиями остановок и маршрутов.
- `underlayer_width` — толщина подложки под названиями остановок и маршрутов. Задаёт значение атрибута stroke-width элемента `<text>`. Вещественное число в диапазоне от `0` до `100000`.
- `color_palette` — цветовая палитра. Непустой массив.

Цвет в `underlayer_color` и массиве `color_palette` можно указать:
- в виде строки, например, `"red"` или `"black"`;
- в массиве из трёх целых чисел диапазона `[0, 255]`. Они определяют `r`, `g` и `b` компоненты цвета в формате `svg::Rgb`. Цвет `[255, 16, 12]` нужно вывести как `rgb(255, 16, 12)`;
- в массиве из четырёх элементов: три целых числа в диапазоне от `[0, 255]` и одно вещественное число в диапазоне от `[0.0, 1.0]`. Они задают составляющие `red`, `green`, `blue` и `opacity` цвета формата `svg::Rgba`. Цвет, заданный как `[255, 200, 23, 0.85]`, должен быть выведен как `rgba(255, 200, 23, 0.85)`.
#### Пример заполнения словаря render_settings
```
{
  "bus_label_font_size": 20,
  "bus_label_offset": [
    7,
    15
  ],
  "color_palette": [
    "green",
    [
      255,
      160,
      0
    ],
    "red"
  ],
  "height": 1200,
  "line_width": 14,
  "padding": 30,
  "stop_label_font_size": 20,
  "stop_label_offset": [
    7,
    -3
  ],
  "stop_radius": 5,
  "underlayer_color": [
    255,
    255,
    255,
    0.85
  ],
  "underlayer_width": 3,
  "width": 1200
}
```
### Структура словаря routing_settings
- `bus_wait_time` — время ожидания автобуса на остановке, в минутах. Считается, что когда бы человек ни пришёл на остановку и какой бы ни была эта остановка, он будет ждать любой автобус в точности указанное количество минут. Значение — целое число от `1` до `1000`.
- `bus_velocity` — скорость автобуса, в км/ч. Считается, что скорость любого автобуса постоянна и в точности равна указанному числу. Время стоянки на остановках не учитывается, время разгона и торможения тоже. Значение — вещественное число от `1` до `1000`.
#### Пример заполнения словаря routing_settings
```
{
  "bus_velocity": 40,
  "bus_wait_time": 6
}
```
### Содержание stat_requests
Массив `stat_requests` может содержать в себе информацию трех типов:
- Запрос на получение информации об автобусной остановке - словарь с ключами:
    - `type` — строка "Stop", означающая, что запрос относится к остановке;
    - `name` — название остановки;
    - `id` - идентификационный номер запроса.
- Запрос на получение информации об автобусном маршруте - словарь с ключами:
    - `type` — строка "Bus", означающая, что запрос относится к автобусному маршруту;
    - `name` — название маршрута;
    - `id` - идентификационный номер запроса.
- Запрос на построение маршрута между двумя остановками - словарь с ключами:
    - `type` — строка "Route", означающая, что запрос относится к построению маршрута;
    - `from` — остановка, где нужно начать маршрут;
    - `to` — остановка, где нужно закончить маршрут;
    - `id` - идентификационный номер запроса.
#### Пример запроса информации по остановке
  ```
{
  "id": 3,
  "name": "Universam",
  "type": "Stop"
}
```
#### Пример запроса информации по автобусному маршруту
  ```
{
  "id": 1,
  "name": "297",
  "type": "Bus"
}
```
#### Пример запроса информации по построению маршрута
  ```
{
  "from": "Biryulyovo Zapadnoye",
  "id": 4,
  "to": "Universam",
  "type": "Route"
}
```
## Формат выходных данных
На выходе программа выдает два файла: `out.json` и `out_image.svg`.
### Содержание файла out.json
Файл out.json содержит массив словарей с ответами на полученные запросы, а именно:
- Ответ на запрос информации об остановке, словарь с ключами:
  - `busses` — массив номеров автобусов, проезжающих через эту остановку;
  - `request_id` - целое число, равное id соответствующего запроса.
- Ответ на запрос информации по автобусному маршруту, словарь с ключами:
  - `curvature` — число типа `double`, задающее извилистость маршрута. Извилистость равна отношению длины дорожного расстояния маршрута к длине географического расстояния;
  - `request_id` — целое число, равное `id` соответствующего запроса;
  - `route_length` — целое число, равное длине маршрута в метрах;
  - `stop_count` — количество остановок на маршруте;
  - `unique_stop_count` — количество уникальных остановок на маршруте.
- Ответ на запрос построения маршрута, словарь с ключами:
  - `request_id` — целое число, равное `id` соответствующего запроса;
  - `total_time` — вещественное число, суммарное время в минутах, которое требуется для прохождения маршрута;
  - `items` — массив элементов маршрута, каждый из которых описывает непрерывную активность пассажира, требующую временных затрат. Бывает двух типов:
    - Ожидание на остановке, словарь с ключами:
      - `type` — строка "Wait", означающая, что элемент относится к ожиданию на остановке;
      - `name` — название остановки;
      - `time` — целое число, время ожидания на остановке;
    - Поездка на автобусе, словарь с ключами:
      - `type` — строка "Bus", означающая, что элемент относится к поездке на автобусе;
      - `bus` — номер автобуса;
      - `time` — вещественное число, время поездки на автобусе;
      - `span_count` — количество остановок, которое необходимо проехать на этом автобусе
- Ответ на запрос информации по несуществующему автобусному маршруту, остановке или отсутствия маршрута между остановками при его построении, словарь с ключами:
    - `request_id` — целое число, равное `id` соответствующего запроса;
    - `error_message` — строка "not found";
#### Пример ответа на запрос об остановке
```
{
  "buses": [
    "297",
    "635"
  ],
  "request_id": 3
}
```
#### Пример ответа на запрос по автобусному маршруту
```
{
  "curvature": 1.42963,
  "request_id": 1,
  "route_length": 5990,
  "stop_count": 4,
  "unique_stop_count": 3
}
```
#### Пример ответа на запрос построения машрута
```
{
  "items": [
    {
      "stop_name": "Biryulyovo Zapadnoye",
      "time": 6,
      "type": "Wait"
    },
    {
      "bus": "297",
      "span_count": 2,
      "time": 5.235,
      "type": "Bus"
    }
  ],
  "request_id": 4,
  "total_time": 11.235
}
```
#### Пример ответа на запрос по несуществующему автобусному маршруту
```
{
  "request_id": 2,
  "error_message": "not found"
}
```
### Пример файла out_image.svg
![Пример изображения](https://pictures.s3.yandex.net/resources/ts_1647600900.svg)
